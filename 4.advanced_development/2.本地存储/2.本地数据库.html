<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>本地用户登录</title>
</head>

<body>

    <h1>本地用户登录</h1>
    <form>
        用户名：<input type="text" name="username" id="name"><br><br>
        密码：<input type="password" name="password" id="password"><br><br>
        <input type="button" id="save" value="登录">
        <input type="button" id="clear" value="注销">
    </form>

    <dl id="datalist"></dl>

    <script>
        var db = openDatabase('db', '1.0', 'first database', 2 * 1024 * 1024);

        // 创建表格
        db.transaction(function (tx) {
            tx.executeSql('CREATE TABLE IF NOT EXISTS msgDate(name TEXT, password TEXT, time INTEGER)', []);
        });

        document.getElementById('clear').onclick = function () {
            db.transaction(function (tx) {
                tx.executeSql('DROP TABLE msgDate', []);
            });
        };

        document.getElementById('save').onclick = function () {
            saveData();
            return false;
        };

        function removeData() {
            var datalist = document.getElementById('datalist');
            while (datalist.firstChild) {
                datalist.removeChild(datalist.firstChild);
            }
        }

        function showData(row) {
            var datalist = document.getElementById('datalist');

            var dt = document.createElement('dt');
            dt.innerHTML = "用户名：" + row.name;

            var dd = document.createElement('dd');
            dd.innerHTML = "密码：" + row.password;

            var tt = document.createElement('tt');
            var t = new Date();
            t.setTime(row.time);
            tt.innerHTML = "时间：" + t.toLocaleDateString() + " " + t.toLocaleTimeString();

            datalist.appendChild(dt);
            datalist.appendChild(dd);
            datalist.appendChild(tt);
        }

        function showAllData() {
            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM msgDate', [], function (tx, result) {
                    removeData();
                    for (var i = 0; i < result.rows.length; i++) {
                        var row = result.rows.item(i);
                        showData(row);
                    }
                });
            });
        }

        function addData(name, password, time) {
            db.transaction(function (tx) {
                tx.executeSql('INSERT INTO msgDate (name, password, time) VALUES (?, ?, ?)', [name, password, time],
                    function (tx, result) {
                        alert('登录成功！');
                    },
                    function (tx, error) {
                        alert("Error: " + error.message);
                    }
                );
            });
        }

        function saveData() {
            var name = document.getElementById('name').value;
            var password = document.getElementById('password').value;
            var time = new Date().getTime();
            addData(name, password, time);
            showAllData();
        }

        // 显示所有数据
        showAllData();
    </script>
</body>

</html>